@model MessagesListViewModel

@{
    ViewData["Title"] = $"{Model.MessageType} Messages";
}

<div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4">
    <div>
        <h1 class="h2 fw-bold mb-2">
            @if (Model.MessageType == "Inbound")
            {
                <i class="fas fa-inbox me-3 text-primary"></i>
            }
            else if (Model.MessageType == "Outbound")
            {
                <i class="fas fa-paper-plane me-3 text-success"></i>
            }
            else
            {
                <i class="fas fa-clock me-3 text-info"></i>
            }
            @Model.MessageType Messages
        </h1>
        <p class="text-muted">Total: @Model.TotalMessages messages</p>
    </div>
    <div class="d-flex flex-wrap gap-2 mt-3 mt-lg-0">
        <a href="/mirage-dashboard" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
        </a>
    </div>
</div>

<!-- Filters -->
<div class="card shadow-sm mb-4">
    <div class="card-body">
        <form method="get" class="row g-3 align-items-end">
            <input type="hidden" name="type" value="@Model.MessageType.ToLower()" />
            
            <div class="col-md-3">
                <label for="statusFilter" class="form-label">Status Filter</label>
                <select name="statusFilter" id="statusFilter" class="form-select">
                    <option value="">All Statuses</option>
                    @foreach (var status in Model.AvailableStatuses)
                    {
                        <option value="@status" selected="@(Model.StatusFilter == status)">@status</option>
                    }
                </select>
            </div>
            
            @if (Model.MessageType == "Outbound")
            {
                <div class="col-md-3">
                    <label for="contractFilter" class="form-label">Contract Filter</label>
                    <select name="contractFilter" id="contractFilter" class="form-select">
                        <option value="">All Contracts</option>
                        @foreach (var contract in Model.AvailableContracts)
                        {
                            <option value="@contract" selected="@(Model.ContractFilter == contract)">@contract</option>
                        }
                    </select>
                </div>
                
                <div class="col-md-3">
                    <label for="endpointFilter" class="form-label">Endpoint Filter</label>
                    <select name="endpointFilter" id="endpointFilter" class="form-select">
                        <option value="">All Endpoints</option>
                        @foreach (var endpoint in Model.AvailableEndpoints)
                        {
                            <option value="@endpoint" selected="@(Model.EndpointFilter == endpoint)">@endpoint</option>
                        }
                    </select>
                </div>
            }
            
            <div class="col-md-2">
                <label for="pageSize" class="form-label">Page Size</label>
                <select name="pageSize" id="pageSize" class="form-select">
                    <option value="20" selected="@(Model.PageSize == 20)">20</option>
                    <option value="50" selected="@(Model.PageSize == 50)">50</option>
                    <option value="100" selected="@(Model.PageSize == 100)">100</option>
                </select>
            </div>
            
            <div class="col-md-1">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-filter me-2"></i>Filter
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Messages List -->
<div id="messages-list" 
     hx-get="/mirage-dashboard/messages?type=@Model.MessageType.ToLower()&page=@Model.CurrentPage&pageSize=@Model.PageSize&statusFilter=@Model.StatusFilter&contractFilter=@Model.ContractFilter&endpointFilter=@Model.EndpointFilter" 
     hx-trigger="every 10s" 
     hx-indicator=".messages-indicator">
    @await Html.PartialAsync("_MessagesList", Model)
</div>

<!-- Loading Indicator -->
<div class="d-flex justify-content-center mt-4">
    <div class="spinner-border text-primary messages-indicator htmx-indicator" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>